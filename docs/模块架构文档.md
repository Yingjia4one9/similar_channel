# æ¨¡å—æ¶æ„æ–‡æ¡£

## ä¸€ã€æ¨¡å—æ¦‚è§ˆ

æœ¬é¡¹ç›®é‡‡ç”¨åˆ†å±‚æ¶æ„è®¾è®¡ï¼Œæ¨¡å—èŒè´£æ¸…æ™°ï¼Œä¾èµ–å…³ç³»æ˜ç¡®ã€‚

### æ¨¡å—åˆ†ç±»

#### 1. åŸºç¡€è®¾æ–½å±‚ï¼ˆInfrastructure Layerï¼‰

**logger.py** - æ—¥å¿—ç®¡ç†æ¨¡å—
- **èŒè´£**ï¼šç»Ÿä¸€ç®¡ç†åº”ç”¨çš„æ—¥å¿—è®°å½•
- **ä¾èµ–**ï¼šæ— ï¼ˆåªä¾èµ–Pythonæ ‡å‡†åº“ï¼‰
- **å¯¼å‡º**ï¼š`get_logger()`, `setup_logger()`
- **è¯´æ˜**ï¼šæä¾›å…¨å±€æ—¥å¿—å®ä¾‹ï¼Œç»Ÿä¸€æ—¥å¿—æ ¼å¼

**config.py** - é…ç½®ç®¡ç†æ¨¡å—
- **èŒè´£**ï¼šé›†ä¸­ç®¡ç†åº”ç”¨é…ç½®
- **ä¾èµ–**ï¼š`os`, `json`, `pathlib`ï¼ˆæ ‡å‡†åº“ï¼‰
- **å¯¼å‡º**ï¼š`Config` ç±»
- **è¯´æ˜**ï¼šæ”¯æŒç¯å¢ƒå˜é‡ã€é…ç½®æ–‡ä»¶ã€å¤šç¯å¢ƒé…ç½®ï¼ˆdevelopment/production/testingï¼‰

**utils.py** - å·¥å…·å‡½æ•°æ¨¡å—
- **èŒè´£**ï¼šæä¾›é€šç”¨å·¥å…·å‡½æ•°
- **ä¾èµ–**ï¼šæ— ï¼ˆåªä¾èµ–Pythonæ ‡å‡†åº“ï¼‰
- **å¯¼å‡º**ï¼š`build_text_for_channel()`, `extract_emails_from_text()`
- **è¯´æ˜**ï¼šæ–‡æœ¬å¤„ç†ã€é‚®ç®±æå–ç­‰é€šç”¨åŠŸèƒ½

**validation.py** - æ•°æ®éªŒè¯æ¨¡å—
- **èŒè´£**ï¼šç»Ÿä¸€ç®¡ç†æ•°æ®éªŒè¯é€»è¾‘
- **ä¾èµ–**ï¼š`logger`, `re`ï¼ˆæ ‡å‡†åº“ï¼‰
- **å¯¼å‡º**ï¼š
  - `validate_channel_id()` - éªŒè¯é¢‘é“IDæ ¼å¼
  - `validate_channel_url()` - éªŒè¯é¢‘é“URLæ ¼å¼
  - `validate_subscriber_count()` - éªŒè¯è®¢é˜…æ•°
  - `validate_similarity_score()` - éªŒè¯ç›¸ä¼¼åº¦åˆ†æ•°
  - `validate_search_request()` - éªŒè¯æœç´¢è¯·æ±‚å‚æ•°
  - `validate_channel_data()` - éªŒè¯é¢‘é“æ•°æ®å­—å…¸
- **è¯´æ˜**ï¼šé›†ä¸­ç®¡ç†æ•°æ®éªŒè¯è§„åˆ™ï¼Œæä¾›ç»Ÿä¸€çš„éªŒè¯æ¥å£

#### 2. æ•°æ®è®¿é—®å±‚ï¼ˆData Access Layerï¼‰

**database.py** - æœ¬åœ°æ•°æ®åº“æ“ä½œæ¨¡å—
- **èŒè´£**ï¼šå¤„ç†SQLiteæ•°æ®åº“çš„è¯»å†™æ“ä½œï¼Œæä¾›FAISSç´¢å¼•æ”¯æŒ
- **ä¾èµ–**ï¼š`logger`, `numpy`, `faiss`ï¼ˆå¯é€‰ï¼‰
- **å¯¼å‡º**ï¼š
  - `get_db_connection()` - æ•°æ®åº“è¿æ¥ä¸Šä¸‹æ–‡ç®¡ç†å™¨ï¼ˆå¢å¼ºç‰ˆï¼Œæ”¯æŒäº‹åŠ¡ç®¡ç†ï¼‰
  - `ensure_schema()` - ç¡®ä¿æ•°æ®åº“è¡¨ç»“æ„å’Œç´¢å¼•å­˜åœ¨
  - `get_candidates_from_local_index()` - ä»æœ¬åœ°ç´¢å¼•è·å–å€™é€‰é¢‘é“
  - `get_channel_info_from_local_db()` - æ‰¹é‡è·å–é¢‘é“ä¿¡æ¯
  - `get_single_channel_info_from_local_db()` - è·å–å•ä¸ªé¢‘é“ä¿¡æ¯
  - `get_embeddings_from_local_db()` - è·å–é¢‘é“å‘é‡
- **è¯´æ˜**ï¼šæä¾›æœ¬åœ°æ•°æ®åº“æŸ¥è¯¢åŠŸèƒ½ï¼Œæ”¯æŒFAISSå‘é‡æœç´¢ï¼Œç»Ÿä¸€æ•°æ®åº“è¿æ¥å’Œæ¨¡å¼ç®¡ç†


**quota_tracker.py** - é…é¢è·Ÿè¸ªæ¨¡å—
- **èŒè´£**ï¼šè·Ÿè¸ªYouTube APIé…é¢æ¶ˆè€—ï¼Œè®°å½•é™çº§ç»Ÿè®¡
- **ä¾èµ–**ï¼š`logger`
- **å¯¼å‡º**ï¼š
  - `record_quota_usage()` - è®°å½•é…é¢ä½¿ç”¨
  - `record_fallback_usage()` - è®°å½•é™çº§ä½¿ç”¨
  - `get_quota_usage_today()` - è·å–ä»Šæ—¥é…é¢ä½¿ç”¨
  - `get_fallback_stats()` - è·å–é™çº§ç»Ÿè®¡
  - `get_quota_status()` - è·å–é…é¢çŠ¶æ€
- **è¯´æ˜**ï¼šé…é¢ç®¡ç†å’Œç»Ÿè®¡åŠŸèƒ½

**result_cache.py** - ç»“æœç¼“å­˜æ¨¡å—
- **èŒè´£**ï¼šç¼“å­˜æœç´¢ç»“æœï¼Œæ”¯æŒCSVå¯¼å‡º
- **ä¾èµ–**ï¼š`logger`
- **å¯¼å‡º**ï¼š`generate_result_id()`, `store_result()`, `get_result()`
- **è¯´æ˜**ï¼šå†…å­˜ç¼“å­˜æœç´¢ç»“æœï¼Œé¿å…é‡å¤è®¡ç®—

**cache.py** - å†…å­˜ç¼“å­˜æ¨¡å—
- **èŒè´£**ï¼šæä¾›å†…å­˜ç¼“å­˜åŠŸèƒ½ï¼Œå‡å°‘é‡å¤çš„APIè°ƒç”¨
- **ä¾èµ–**ï¼š`logger`
- **å¯¼å‡º**ï¼š
  - `SimpleCache` ç±»
  - `cached_channel_info()` - é¢‘é“ä¿¡æ¯ç¼“å­˜è£…é¥°å™¨
  - `cached_channel_videos()` - è§†é¢‘åˆ—è¡¨ç¼“å­˜è£…é¥°å™¨
  - `invalidate_channel_info_cache()` - å¤±æ•ˆé¢‘é“ä¿¡æ¯ç¼“å­˜
  - `invalidate_all_channel_caches()` - å¤±æ•ˆæ‰€æœ‰é¢‘é“ç¼“å­˜
- **è¯´æ˜**ï¼šçº¿ç¨‹å®‰å…¨çš„å†…å­˜ç¼“å­˜å®ç°

**metrics.py** - æŒ‡æ ‡ç»Ÿè®¡æ¨¡å—
- **èŒè´£**ï¼šæ”¶é›†å’Œç»Ÿè®¡ç³»ç»ŸæŒ‡æ ‡
- **ä¾èµ–**ï¼š`logger`, `datetime`, `threading`ï¼ˆæ ‡å‡†åº“ï¼‰
- **å¯¼å‡º**ï¼š
  - `MetricsCollector` ç±» - æŒ‡æ ‡æ”¶é›†å™¨ï¼ˆå•ä¾‹ï¼‰
  - `record_performance()` - è®°å½•æ€§èƒ½æŒ‡æ ‡
  - `record_business_metric()` - è®°å½•ä¸šåŠ¡æŒ‡æ ‡
  - `increment_counter()` - å¢åŠ è®¡æ•°å™¨
  - `get_metrics_collector()` - è·å–æŒ‡æ ‡æ”¶é›†å™¨å®ä¾‹
  - `performance_timer()` - æ€§èƒ½è®¡æ—¶è£…é¥°å™¨
- **è¯´æ˜**ï¼šæ€§èƒ½ç›‘æ§ã€ä¸šåŠ¡æŒ‡æ ‡ç»Ÿè®¡ï¼Œæ”¯æŒæ€§èƒ½åˆ†æï¼ˆP50/P95/P99ï¼‰

#### 3. å¤–éƒ¨æœåŠ¡å±‚ï¼ˆExternal Service Layerï¼‰

**youtube_api.py** - YouTube APIå®¢æˆ·ç«¯æ¨¡å—
- **èŒè´£**ï¼šå°è£…YouTube APIè°ƒç”¨ï¼Œå¤„ç†é‡è¯•å’Œé”™è¯¯
- **ä¾èµ–**ï¼š`config`, `logger`, `quota_tracker`, `requests`
- **å¯¼å‡º**ï¼š
  - `YouTubeAPIClient` ç±»
  - `YouTubeQuotaExceededError` å¼‚å¸¸
  - `YouTubeAPIError` å¼‚å¸¸
  - `yt_get()` - ä¾¿æ·APIè°ƒç”¨å‡½æ•°
- **è¯´æ˜**ï¼šç»Ÿä¸€å¤„ç†APIè°ƒç”¨ã€é‡è¯•é€»è¾‘ã€é…é¢è·Ÿè¸ª

#### 4. ä¸šåŠ¡é€»è¾‘å±‚ï¼ˆBusiness Logic Layerï¼‰

**channel_parser.py** - é¢‘é“URLè§£ææ¨¡å—
- **èŒè´£**ï¼šä»YouTube URLä¸­æå–é¢‘é“ID
- **ä¾èµ–**ï¼š`youtube_api`
- **å¯¼å‡º**ï¼š`extract_channel_id_from_url()`
- **è¯´æ˜**ï¼šè§£æå„ç§æ ¼å¼çš„YouTubeé¢‘é“URL

**channel_info.py** - é¢‘é“ä¿¡æ¯è·å–æ¨¡å—
- **èŒè´£**ï¼šè·å–é¢‘é“åŸºç¡€ä¿¡æ¯å’Œè§†é¢‘ä¿¡æ¯
- **ä¾èµ–**ï¼š`cache`, `config`, `logger`, `youtube_api`
- **å¯¼å‡º**ï¼š
  - `get_channel_basic_info()` - è·å–é¢‘é“åŸºç¡€ä¿¡æ¯
  - `batch_get_channels_info()` - æ‰¹é‡è·å–é¢‘é“ä¿¡æ¯
  - `get_recent_video_snippets_for_channel()` - è·å–æœ€è¿‘è§†é¢‘
  - `get_recent_videos_stats()` - è·å–è§†é¢‘ç»Ÿè®¡æ•°æ®
- **è¯´æ˜**ï¼šå°è£…é¢‘é“ä¿¡æ¯è·å–é€»è¾‘ï¼Œä½¿ç”¨ç¼“å­˜å‡å°‘APIè°ƒç”¨

**candidate_collection.py** - å€™é€‰é¢‘é“æ”¶é›†æ¨¡å—
- **èŒè´£**ï¼šæ”¶é›†ç›¸ä¼¼é¢‘é“çš„å€™é€‰ID
- **ä¾èµ–**ï¼š`config`, `logger`, `youtube_api`
- **å¯¼å‡º**ï¼š
  - `search_candidate_channels_by_title()` - æŒ‰æ ‡é¢˜æœç´¢é¢‘é“
  - `collect_candidate_channels_from_related_videos()` - ä»ç›¸å…³è§†é¢‘æ”¶é›†é¢‘é“
- **è¯´æ˜**ï¼šé€šè¿‡å¤šç§æ–¹å¼æ”¶é›†å€™é€‰é¢‘é“

**embedding.py** - å‘é‡åµŒå…¥æ¨¡å—
- **èŒè´£**ï¼šæ–‡æœ¬å‘é‡åŒ–å’Œæ ‡ç­¾æ¨ç†
- **ä¾èµ–**ï¼š`config`, `numpy`, `sentence_transformers`
- **å¯¼å‡º**ï¼š
  - `get_embed_model()` - è·å–åµŒå…¥æ¨¡å‹ï¼ˆå•ä¾‹ï¼‰
  - `cosine_similarity()` - è®¡ç®—ä½™å¼¦ç›¸ä¼¼åº¦
  - `infer_topics_and_audience()` - æ¨ç†ä¸»é¢˜å’Œå—ä¼—æ ‡ç­¾
  - `ensure_label_embeddings()` - ç¡®ä¿æ ‡ç­¾å‘é‡å·²åŠ è½½
- **è¯´æ˜**ï¼šä½¿ç”¨sentence-transformersè¿›è¡Œæ–‡æœ¬å‘é‡åŒ–

**similarity.py** - ç›¸ä¼¼åº¦è®¡ç®—æ¨¡å—
- **èŒè´£**ï¼šè®¡ç®—é¢‘é“ç›¸ä¼¼åº¦è¯„åˆ†
- **ä¾èµ–**ï¼š`config`, `numpy`
- **å¯¼å‡º**ï¼š
  - `calculate_tag_overlap()` - è®¡ç®—æ ‡ç­¾é‡åˆåº¦
  - `calculate_total_score()` - è®¡ç®—æ€»è¯„åˆ†
  - `scale_score()` - è®¡ç®—è§„æ¨¡è¯„åˆ†
- **è¯´æ˜**ï¼šç›¸ä¼¼åº¦è¯„åˆ†ç®—æ³•å®ç°

**bd_scoring.py** - BDè¯„åˆ†æ¨¡å—ï¼ˆäº¤æ˜“æ‰€BDä¸“ç”¨ï¼‰
- **èŒè´£**ï¼šä¸ºäº¤æ˜“æ‰€BDå¯»æ‰¾KOLæä¾›ä¸“ä¸šè¯„åˆ†åŠŸèƒ½
- **ä¾èµ–**ï¼š`config`, `logger`
- **å¯¼å‡º**ï¼š
  - `detect_competitor_collaborations()` - æ£€æµ‹ç«å“äº¤æ˜“æ‰€åˆä½œ
  - `calculate_contract_focus_score()` - è®¡ç®—åˆçº¦å†…å®¹èšç„¦åº¦
  - `calculate_audience_quality_score()` - è®¡ç®—å—ä¼—è´¨é‡è¯„åˆ†
  - `calculate_commercialization_score()` - è®¡ç®—å•†ä¸šåŒ–æ½œåŠ›è¯„åˆ†
  - `calculate_bd_total_score()` - è®¡ç®—BDç»¼åˆè¯„åˆ†
  - `calculate_full_bd_metrics()` - è®¡ç®—å®Œæ•´BDæŒ‡æ ‡ï¼ˆä¾¿æ·å‡½æ•°ï¼‰
- **è¯´æ˜**ï¼šé’ˆå¯¹åˆçº¦è¿”ä½£KOLç­›é€‰çš„ä¸“ä¸šè¯„åˆ†ç³»ç»Ÿï¼ŒåŒ…æ‹¬ç«å“æ£€æµ‹ã€å•†ä¸šåŒ–åˆ†æ

#### 5. åº”ç”¨æœåŠ¡å±‚ï¼ˆApplication Service Layerï¼‰

**youtube_client.py** - YouTubeç›¸ä¼¼é¢‘é“æŸ¥æ‰¾ä¸»æ¨¡å—
- **èŒè´£**ï¼šæ•´åˆå„ä¸ªåŠŸèƒ½æ¨¡å—ï¼Œæä¾›é«˜å±‚API
- **ä¾èµ–**ï¼šå¤šä¸ªä¸šåŠ¡é€»è¾‘æ¨¡å—
- **å¯¼å‡º**ï¼š
  - `get_similar_channels_by_url()` - ä¸»æœç´¢å‡½æ•°
  - `YouTubeQuotaExceededError` - å¼‚å¸¸ç±»ï¼ˆé‡æ–°å¯¼å‡ºï¼‰
- **è¯´æ˜**ï¼šæ ¸å¿ƒä¸šåŠ¡é€»è¾‘æ•´åˆï¼Œå®ç°å®Œæ•´çš„ç›¸ä¼¼é¢‘é“æœç´¢æµç¨‹

**build_channel_index.py** - é¢‘é“ç´¢å¼•æ„å»ºæ¨¡å—
- **èŒè´£**ï¼šæ„å»ºå’Œç»´æŠ¤æœ¬åœ°é¢‘é“ç´¢å¼•
- **ä¾èµ–**ï¼šå¤šä¸ªä¸šåŠ¡é€»è¾‘æ¨¡å—
- **å¯¼å‡º**ï¼š
  - `build_index()` - æ„å»ºç´¢å¼•ä¸»å‡½æ•°
  - `_batch_upsert_channels()` - æ‰¹é‡æ›´æ–°é¢‘é“ï¼ˆå†…éƒ¨å‡½æ•°ï¼Œå¯è¢«youtube_clientå»¶è¿Ÿå¯¼å…¥ï¼‰
- **è¯´æ˜**ï¼šæ‰¹é‡å¤„ç†é¢‘é“æ•°æ®ï¼Œæ„å»ºæœ¬åœ°ç´¢å¼•

#### 6. åº”ç”¨æ¥å£å±‚ï¼ˆApplication Interface Layerï¼‰

**main.py** - FastAPIåº”ç”¨å…¥å£
- **èŒè´£**ï¼šæä¾›HTTP APIæ¥å£
- **ä¾èµ–**ï¼šæ‰€æœ‰ä¸šåŠ¡æ¨¡å—
- **å¯¼å‡º**ï¼šFastAPIåº”ç”¨å®ä¾‹
- **è¯´æ˜**ï¼šRESTful APIæ¥å£ï¼Œå¤„ç†HTTPè¯·æ±‚

---

## äºŒã€æ¨¡å—ä¾èµ–å…³ç³»å›¾

```
åº”ç”¨æ¥å£å±‚
â””â”€â”€ main.py
    â””â”€â”€ youtube_client.py
        â”œâ”€â”€ cache.py
        â”œâ”€â”€ candidate_collection.py
        â”œâ”€â”€ channel_info.py
        â”œâ”€â”€ channel_parser.py
        â”œâ”€â”€ config.py
        â”œâ”€â”€ database.py
        â”œâ”€â”€ embedding.py
        â”œâ”€â”€ logger.py
        â”œâ”€â”€ quota_tracker.py
        â”œâ”€â”€ similarity.py
        â”œâ”€â”€ utils.py
        â”œâ”€â”€ youtube_api.py
        â””â”€â”€ build_channel_index.py (å»¶è¿Ÿå¯¼å…¥)
            â””â”€â”€ (ä¾èµ–ä¸youtube_clientç±»ä¼¼)

åŸºç¡€è®¾æ–½å±‚
â”œâ”€â”€ logger.py (æ— ä¾èµ–)
â”œâ”€â”€ config.py â†’ os, json, pathlib
â”œâ”€â”€ utils.py (æ— ä¾èµ–)
â””â”€â”€ validation.py â†’ logger, re

æ•°æ®è®¿é—®å±‚
â”œâ”€â”€ database.py â†’ logger
â”œâ”€â”€ quota_tracker.py â†’ logger
â”œâ”€â”€ result_cache.py â†’ logger
â””â”€â”€ cache.py â†’ logger

å¤–éƒ¨æœåŠ¡å±‚
â””â”€â”€ youtube_api.py â†’ config, logger, quota_tracker

ä¸šåŠ¡é€»è¾‘å±‚
â”œâ”€â”€ channel_parser.py â†’ youtube_api
â”œâ”€â”€ channel_info.py â†’ cache, config, logger, youtube_api
â”œâ”€â”€ candidate_collection.py â†’ config, logger, youtube_api
â”œâ”€â”€ embedding.py â†’ config, numpy, sentence_transformers
â”œâ”€â”€ similarity.py â†’ config, numpy
â””â”€â”€ bd_scoring.py â†’ config, logger

ç›‘æ§ç»Ÿè®¡å±‚
â””â”€â”€ metrics.py â†’ logger, datetime, threading
```

---

## ä¸‰ã€æ¨¡å—èŒè´£è¯´æ˜

### æ¨¡å—åˆ’åˆ†åŸåˆ™

1. **å•ä¸€èŒè´£åŸåˆ™**ï¼šæ¯ä¸ªæ¨¡å—åªè´Ÿè´£ä¸€ä¸ªæ˜ç¡®çš„åŠŸèƒ½é¢†åŸŸ
2. **ä¾èµ–å€’ç½®åŸåˆ™**ï¼šé«˜å±‚æ¨¡å—ä¸ç›´æ¥ä¾èµ–ä½å±‚æ¨¡å—ï¼Œé€šè¿‡æ¥å£æŠ½è±¡
3. **æœ€å°ä¾èµ–åŸåˆ™**ï¼šæ¨¡å—åªä¾èµ–å¿…è¦çš„å…¶ä»–æ¨¡å—
4. **åˆ†å±‚æ¶æ„**ï¼šæŒ‰ç…§åŸºç¡€è®¾æ–½ã€æ•°æ®è®¿é—®ã€ä¸šåŠ¡é€»è¾‘ã€åº”ç”¨æœåŠ¡ã€åº”ç”¨æ¥å£åˆ†å±‚

### æ¨¡å—èŒè´£è¾¹ç•Œ

| æ¨¡å— | èŒè´£è¾¹ç•Œ | ä¸åº”åŒ…å« |
|------|---------|---------|
| logger.py | æ—¥å¿—è®°å½• | ä¸šåŠ¡é€»è¾‘ |
| config.py | é…ç½®ç®¡ç† | ä¸šåŠ¡é€»è¾‘ |
| database.py | æ•°æ®åº“æ“ä½œ | APIè°ƒç”¨ã€ä¸šåŠ¡é€»è¾‘ |
| youtube_api.py | APIè°ƒç”¨å°è£… | ä¸šåŠ¡é€»è¾‘ã€æ•°æ®åº“æ“ä½œ |
| channel_info.py | é¢‘é“ä¿¡æ¯è·å– | ç›¸ä¼¼åº¦è®¡ç®—ã€ç´¢å¼•æ„å»º |
| youtube_client.py | ä¸šåŠ¡é€»è¾‘æ•´åˆ | æ•°æ®åº“æ“ä½œç»†èŠ‚ã€APIè°ƒç”¨ç»†èŠ‚ |
| bd_scoring.py | BDä¸“å±è¯„åˆ†é€»è¾‘ | APIè°ƒç”¨ã€æ•°æ®åº“æ“ä½œ |

---

## å››ã€å¾ªç¯ä¾èµ–åˆ†æ

### å½“å‰ä¾èµ–å…³ç³»æ£€æŸ¥

âœ… **æ— å¾ªç¯ä¾èµ–**

å…³é”®è®¾è®¡ï¼š
1. **å»¶è¿Ÿå¯¼å…¥**ï¼š`youtube_client.py` ä½¿ç”¨å»¶è¿Ÿå¯¼å…¥é¿å…ä¸ `build_channel_index.py` çš„å¾ªç¯ä¾èµ–
   ```python
   # youtube_client.py ç¬¬48-54è¡Œ
   try:
       from build_channel_index import _batch_upsert_channels
       DB_SAVE_AVAILABLE = True
   except ImportError:
       DB_SAVE_AVAILABLE = False
   ```

2. **å•å‘ä¾èµ–**ï¼šä¾èµ–å…³ç³»æ˜¯å•å‘çš„ï¼Œä»åº”ç”¨å±‚åˆ°åŸºç¡€è®¾æ–½å±‚
   - åº”ç”¨å±‚ â†’ ä¸šåŠ¡é€»è¾‘å±‚ â†’ æ•°æ®è®¿é—®å±‚ â†’ åŸºç¡€è®¾æ–½å±‚

3. **æ¥å£æŠ½è±¡**ï¼šé€šè¿‡å‡½æ•°æ¥å£è€Œéç±»ç»§æ‰¿ï¼Œé™ä½è€¦åˆåº¦

### å·²è§£å†³çš„é—®é¢˜

âœ… **database_utils.py ä¸ database.py å·²åˆå¹¶**
- å·²å®Œæˆï¼š`database_utils.py` çš„åŠŸèƒ½å·²åˆå¹¶åˆ° `database.py`
- æ”¹è¿›ï¼šç»Ÿä¸€æ•°æ®åº“è¿æ¥ç®¡ç†ï¼Œå¢å¼ºäº‹åŠ¡å¤„ç†å’Œé”™è¯¯å¤„ç†

---

## äº”ã€æ¨¡å—æ¥å£è¯´æ˜

### æ ¸å¿ƒæ¥å£

#### 1. ç›¸ä¼¼é¢‘é“æœç´¢æ¥å£

**æ¨¡å—**ï¼š`youtube_client.py`
**å‡½æ•°**ï¼š`get_similar_channels_by_url()`
**è¾“å…¥**ï¼š
- `channel_url`: é¢‘é“URL
- `max_results`: æœ€å¤§ç»“æœæ•°
- `min_subscribers`, `max_subscribers`: è®¢é˜…æ•°ç­›é€‰
- `preferred_language`, `preferred_region`: è¯­è¨€/åœ°åŒºç­›é€‰
- `min_similarity`: æœ€å°ç›¸ä¼¼åº¦
- `progress_callback`: è¿›åº¦å›è°ƒï¼ˆå¯é€‰ï¼‰

**è¾“å‡º**ï¼š
- `base_channel`: åŸºé¢‘é“ä¿¡æ¯
- `similar_channels`: ç›¸ä¼¼é¢‘é“åˆ—è¡¨
- `quota_exceeded_channels`: é…é¢ä¸è¶³çš„é¢‘é“åˆ—è¡¨

#### 2. æ•°æ®åº“æŸ¥è¯¢æ¥å£

**æ¨¡å—**ï¼š`database.py`
**ä¸»è¦å‡½æ•°**ï¼š
- `get_candidates_from_local_index()` - å‘é‡æœç´¢å€™é€‰é¢‘é“
- `get_channel_info_from_local_db()` - æ‰¹é‡è·å–é¢‘é“ä¿¡æ¯
- `get_embeddings_from_local_db()` - è·å–é¢‘é“å‘é‡

#### 3. é…é¢ç®¡ç†æ¥å£

**æ¨¡å—**ï¼š`quota_tracker.py`
**ä¸»è¦å‡½æ•°**ï¼š
- `record_quota_usage()` - è®°å½•é…é¢ä½¿ç”¨
- `get_quota_usage_today()` - è·å–ä»Šæ—¥é…é¢ä½¿ç”¨
- `get_fallback_stats()` - è·å–é™çº§ç»Ÿè®¡

---

## å…­ã€æ¨¡å—æ‰©å±•å»ºè®®

### 1. å·²å®Œæˆçš„æ¨¡å—ä¼˜åŒ–

âœ… **database_utils.py ä¸ database.py å·²åˆå¹¶**
- å·²å®Œæˆï¼šç»Ÿä¸€æ•°æ®åº“è¿æ¥å’Œæ¨¡å¼ç®¡ç†
- æ”¹è¿›ï¼šå¢å¼ºäº‹åŠ¡å¤„ç†ã€é”™è¯¯å¤„ç†å’Œè¿æ¥ç®¡ç†

âœ… **é…ç½®æ¨¡å—å¢å¼º**
- å·²å®Œæˆï¼šæ”¯æŒé…ç½®æ–‡ä»¶ï¼ˆJSONæ ¼å¼ï¼‰ã€å¤šç¯å¢ƒé…ç½®ï¼ˆdevelopment/production/testingï¼‰
- æ”¹è¿›ï¼šé…ç½®ä¼˜å…ˆçº§ï¼šç¯å¢ƒå˜é‡ > é…ç½®æ–‡ä»¶ > é»˜è®¤å€¼

### 2. å·²åˆ›å»ºçš„æ–°æ¨¡å—

âœ… **metrics.py** - æŒ‡æ ‡ç»Ÿè®¡æ¨¡å—
- èŒè´£ï¼šæ”¶é›†å’Œç»Ÿè®¡ç³»ç»ŸæŒ‡æ ‡
- ä¾èµ–ï¼š`logger`, `datetime`, `threading`
- åŠŸèƒ½ï¼š
  - æ€§èƒ½æŒ‡æ ‡ç»Ÿè®¡ï¼ˆP50/P95/P99ç™¾åˆ†ä½æ•°ï¼‰
  - ä¸šåŠ¡æŒ‡æ ‡ç»Ÿè®¡
  - è®¡æ•°å™¨ç®¡ç†
  - æ€§èƒ½è®¡æ—¶è£…é¥°å™¨
- è¯´æ˜ï¼šå•ä¾‹æ¨¡å¼ï¼Œçº¿ç¨‹å®‰å…¨ï¼Œæ”¯æŒå†å²æ•°æ®æ¸…ç†

âœ… **validation.py** - æ•°æ®éªŒè¯æ¨¡å—
- èŒè´£ï¼šç»Ÿä¸€æ•°æ®éªŒè¯é€»è¾‘
- ä¾èµ–ï¼š`logger`, `re`
- åŠŸèƒ½ï¼š
  - é¢‘é“ID/URLéªŒè¯
  - æœç´¢è¯·æ±‚å‚æ•°éªŒè¯
  - é¢‘é“æ•°æ®å®Œæ•´æ€§éªŒè¯
  - æ•°å€¼èŒƒå›´éªŒè¯
- è¯´æ˜ï¼šé›†ä¸­ç®¡ç†æ•°æ®éªŒè¯è§„åˆ™ï¼Œæä¾›ç»Ÿä¸€çš„éªŒè¯æ¥å£

---

## ä¸ƒã€æ¨¡å—æµ‹è¯•å»ºè®®

### å•å…ƒæµ‹è¯•

æ¯ä¸ªæ¨¡å—åº”åŒ…å«å•å…ƒæµ‹è¯•ï¼š
- **åŸºç¡€è®¾æ–½å±‚**ï¼šlogger, config, utils
- **æ•°æ®è®¿é—®å±‚**ï¼šdatabase, cache, quota_tracker
- **ä¸šåŠ¡é€»è¾‘å±‚**ï¼šchannel_info, embedding, similarity

### é›†æˆæµ‹è¯•

æµ‹è¯•æ¨¡å—é—´çš„åä½œï¼š
- `youtube_client` ä¸å„ä¸šåŠ¡æ¨¡å—çš„é›†æˆ
- `main.py` APIæ¥å£çš„ç«¯åˆ°ç«¯æµ‹è¯•

---

## å…«ã€æ€»ç»“

### æ¨¡å—åˆ’åˆ†ä¼˜ç‚¹

âœ… **èŒè´£æ¸…æ™°**ï¼šæ¯ä¸ªæ¨¡å—èŒè´£æ˜ç¡®ï¼Œæ˜“äºç†è§£å’Œç»´æŠ¤
âœ… **ä¾èµ–åˆç†**ï¼šä¾èµ–å…³ç³»å•å‘ï¼Œæ— å¾ªç¯ä¾èµ–
âœ… **æ˜“äºæ‰©å±•**ï¼šæ–°åŠŸèƒ½å¯ä»¥ç‹¬ç«‹æ¨¡å—å½¢å¼æ·»åŠ 
âœ… **ä¾¿äºæµ‹è¯•**ï¼šæ¨¡å—ç‹¬ç«‹ï¼Œä¾¿äºå•å…ƒæµ‹è¯•

### æ”¹è¿›ç©ºé—´

âš ï¸ **éƒ¨åˆ†æ¨¡å—æ–‡æ¡£ä¸å®Œæ•´**ï¼šå»ºè®®æ·»åŠ æ›´è¯¦ç»†çš„æ¨¡å—æ–‡æ¡£å­—ç¬¦ä¸²
ğŸ’¡ **æŒ‡æ ‡æ”¶é›†å™¨é›†æˆ**ï¼šå»ºè®®åœ¨å…³é”®ä¸šåŠ¡é€»è¾‘ä¸­é›†æˆ metrics.py è¿›è¡Œæ€§èƒ½ç›‘æ§
ğŸ’¡ **æ•°æ®éªŒè¯é›†æˆ**ï¼šå»ºè®®åœ¨ API æ¥å£å±‚ä½¿ç”¨ validation.py è¿›è¡Œç»Ÿä¸€éªŒè¯

---

**æ–‡æ¡£ç‰ˆæœ¬**ï¼š2.0  
**æœ€åæ›´æ–°**ï¼š2025å¹´  
**ç»´æŠ¤è€…**ï¼šå¼€å‘å›¢é˜Ÿ

## ä¹ã€æ”¹è¿›å†å²

### v2.1 (2024)
- âœ… åˆ›å»º `bd_scoring.py` æ¨¡å—ï¼Œæä¾›äº¤æ˜“æ‰€BDä¸“ç”¨KOLç­›é€‰åŠŸèƒ½
- âœ… æ·»åŠ åˆçº¦èšç„¦åº¦ã€å—ä¼—è´¨é‡ã€å•†ä¸šåŒ–æ½œåŠ›ç­‰å¤šç»´åº¦è¯„åˆ†
- âœ… å®ç°ç«å“äº¤æ˜“æ‰€è¿”ä½£é“¾æ¥æ£€æµ‹
- âœ… åœ¨ `config.py` ä¸­æ·»åŠ BDæ¨¡å¼é…ç½®ï¼ˆæ ‡ç­¾ã€æƒé‡ã€é˜ˆå€¼ï¼‰
- âœ… åœ¨ `youtube_client.py` ä¸­é›†æˆBDæ¨¡å¼
- âœ… åœ¨ `main.py` ä¸­æ·»åŠ BDæ¨¡å¼APIæ”¯æŒ
- âœ… CSVå¯¼å‡ºæ”¯æŒBDæ¨¡å¼å­—æ®µ

### v2.0 (2024)
- âœ… åˆå¹¶ `database_utils.py` å’Œ `database.py`ï¼Œç»Ÿä¸€æ•°æ®åº“è¿æ¥å’Œæ¨¡å¼ç®¡ç†
- âœ… å¢å¼º `config.py`ï¼Œæ”¯æŒé…ç½®æ–‡ä»¶å’Œå¤šç¯å¢ƒé…ç½®
- âœ… åˆ›å»º `validation.py` æ¨¡å—ï¼Œç»Ÿä¸€æ•°æ®éªŒè¯é€»è¾‘
- âœ… åˆ›å»º `metrics.py` æ¨¡å—ï¼Œæä¾›æŒ‡æ ‡ç»Ÿè®¡åŠŸèƒ½
- âœ… æ›´æ–°æ¨¡å—æ¶æ„æ–‡æ¡£ï¼Œåæ˜ æ‰€æœ‰æ”¹è¿›

### v1.0 (2024)
- åˆå§‹ç‰ˆæœ¬ï¼ŒåŸºç¡€æ¨¡å—æ¶æ„è®¾è®¡

---

## åã€BDæ¨¡å¼åŠŸèƒ½è¯´æ˜

### åŠŸèƒ½æ¦‚è¿°

BDæ¨¡å¼æ˜¯ä¸“ä¸ºäº¤æ˜“æ‰€BDï¼ˆBusiness Developmentï¼‰è®¾è®¡çš„KOLç­›é€‰åŠŸèƒ½ï¼Œç”¨äºå¯»æ‰¾åˆé€‚çš„åˆçº¦è¿”ä½£åˆä½œå¯¹è±¡ã€‚

### æ ¸å¿ƒè¯„åˆ†ç»´åº¦

| ç»´åº¦ | æƒé‡ | è¯´æ˜ |
|------|------|------|
| åˆçº¦èšç„¦åº¦ | 30% | é¢‘é“å†…å®¹æ˜¯å¦èšç„¦åˆçº¦/æ æ†äº¤æ˜“ |
| å—ä¼—è´¨é‡ | 20% | å—ä¼—æ˜¯å¦ä¸ºçœŸå®äº¤æ˜“è€… |
| å•†ä¸šåŒ–æ½œåŠ› | 20% | æ˜¯å¦æœ‰åˆä½œæ„æ„¿å’Œèƒ½åŠ› |
| äº’åŠ¨ç‡ | 15% | ç²‰ä¸äº’åŠ¨è´¨é‡ |
| è¯­ä¹‰ç›¸ä¼¼åº¦ | 10% | ä¸åŸºé¢‘é“çš„å†…å®¹ç›¸ä¼¼åº¦ |
| è§„æ¨¡ | 5% | è®¢é˜…æ•°è§„æ¨¡ |

### ç«å“æ£€æµ‹

è‡ªåŠ¨æ£€æµ‹é¢‘é“æ˜¯å¦å·²ä¸ä»¥ä¸‹äº¤æ˜“æ‰€æœ‰è¿”ä½£åˆä½œï¼š
- Binanceã€Bybitã€OKXã€Bitget
- Gate.ioã€KuCoinã€MEXCã€HTX
- BingXã€Phemex

### ä¼˜å…ˆçº§åˆ†ç±»

| ä¼˜å…ˆçº§ | BDæ€»åˆ† | å»ºè®®è¡ŒåŠ¨ |
|--------|--------|----------|
| high | > 0.7 | ç«‹å³è”ç³»ï¼Œæä¾›æœ‰ç«äº‰åŠ›çš„è¿”ä½£æ¯”ä¾‹ |
| medium | > 0.5 | åŠ å…¥è”ç³»æ¸…å•ï¼Œå®šæœŸè·Ÿè¿› |
| low | > 0.3 | æ”¾å…¥åå¤‡æ¸…å• |
| skip | â‰¤ 0.3 | ä¸å»ºè®®è”ç³» |

### APIä½¿ç”¨

```json
POST /similar-channels
{
    "channel_url": "https://www.youtube.com/@CryptoTrader",
    "max_results": 50,
    "bd_mode": true
}
```

### è¿”å›å­—æ®µï¼ˆBDæ¨¡å¼ï¼‰

æ¯ä¸ªKOLç»“æœåŒ…å«ï¼š
- `bd_priority`: ä¼˜å…ˆçº§ï¼ˆhigh/medium/low/skipï¼‰
- `bd_total_score`: BDç»¼åˆè¯„åˆ†ï¼ˆ0-1ï¼‰
- `bd_metrics`: è¯¦ç»†è¯„åˆ†æŒ‡æ ‡
  - `contract_focus`: åˆçº¦èšç„¦åº¦
  - `audience_quality`: å—ä¼—è´¨é‡
  - `commercialization`: å•†ä¸šåŒ–æ½œåŠ›
  - `competitor_detection`: ç«å“æ£€æµ‹ç»“æœ
- `bd_recommendation`: åˆä½œå»ºè®®
  - `reasons`: æ¨èç†ç”±
  - `concerns`: æ½œåœ¨é—®é¢˜
  - `action`: è¡ŒåŠ¨å»ºè®®

